<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

  <!-- the config loader depends on the metastore remover because in case of migration we need to drop the disk quota subsystem -->
  <bean id="DiskQuotaConfigLoader" class="org.geowebcache.diskquota.ConfigLoader" depends-on="metastoreRemover">
    <constructor-arg ref="gwcDefaultStorageFinder" />
    <constructor-arg ref="gwcAppCtx" />
    <constructor-arg ref="gwcTLDispatcher" />
  </bean>

  <bean id="DiskQuotaStoreProvider" class="org.geowebcache.diskquota.QuotaStoreProvider">
      <constructor-arg ref="DiskQuotaConfigLoader" />
  </bean>

  <bean id="DiskQuotaMonitor" class="org.geowebcache.diskquota.DiskQuotaMonitor">
    <constructor-arg ref="gwcDefaultStorageFinder" />
    <constructor-arg ref="DiskQuotaConfigLoader" />
    <constructor-arg ref="gwcTLDispatcher" />
    <constructor-arg ref="gwcStorageBroker" />
    <constructor-arg ref="DiskQuotaStoreProvider" />
    <constructor-arg ref="gwcCacheCleaner" />
  </bean>

  <bean id="gwcTilePageCalculator" class="org.geowebcache.diskquota.storage.TilePageCalculator">
    <constructor-arg ref="gwcTLDispatcher" />
  </bean>

  <bean id="gwcCacheCleaner" class="org.geowebcache.diskquota.CacheCleaner">
    <constructor-arg ref="gwcTileBreeder" />
  </bean>

  <!--bean id="mockWMSSource" class="org.geowebcache.util.MockWMSLayerSource"> <description>REMOVE THIS, it's a fake WMS 
    source for all layers!!!</description> <constructor-arg ref="gwcTLDispatcher" /> </bean -->

  <bean id="gwdDiskQuotaResourceFinder" class="org.geowebcache.diskquota.rest.DiskQuotaFinder">
    <constructor-arg ref="DiskQuotaMonitor" />
  </bean>
  
  <bean id="gwcDiskQuotaRestDispatcher" class="org.geowebcache.rest.RESTMapping">
    <property name="routes">
      <map>
        <entry>
          <key>
            <value>/diskquota/{layer}.{extension}"</value>
          </key>
          <ref bean="gwdDiskQuotaResourceFinder" />
        </entry>
        <entry>
          <key>
            <value>/diskquota.{extension}</value>
          </key>
          <ref bean="gwdDiskQuotaResourceFinder" />
        </entry>
      </map>
    </property>
  </bean>

  <!-- The quota store factories -->
  <bean id="bdbQuotaStoreFactory" class="org.geowebcache.diskquota.bdb.BDBQuotaStoreFactory"/>
  <bean id="jdbcQuotaStoreFactory" class="org.geowebcache.diskquota.jdbc.JDBCQuotaStoreFactory"/>
  
  <!-- The SQL dialects -->
  <bean id="H2QuotaDialect" class="org.geowebcache.diskquota.jdbc.H2Dialect"/>
  <bean id="PostgreSQLQuotaDialect" class="org.geowebcache.diskquota.jdbc.PostgreSQLDialect"/>
  <bean id="OracleQuotaDialect" class="org.geowebcache.diskquota.jdbc.OracleDialect"/>
</beans>
